---
/**
 * Comprehensive Schema.org Structured Data Markup
 * Provides JSON-LD for better SEO and rich results
 * 
 * Uses centralized company data from ~/data/company.ts
 */

import { COMPANY, BRANCHES, SUB_ORGANIZATION, getOpeningHoursSchema, getSameAsArray } from '~/data/company';

export interface BreadcrumbItem {
  name: string;
  url: string;
}

export interface FAQItem {
  question: string;
  answer: string;
}

export interface Props {
  type?: 'website' | 'organization' | 'localbusiness' | 'service' | 'article' | 'breadcrumb' | 'faq' | 'attorney';
  data?: Record<string, string | number | boolean | BreadcrumbItem[] | FAQItem[] | undefined>;
}

const { type = 'organization', data = {} } = Astro.props;

// Generate department schema from BRANCHES
const departmentSchema = BRANCHES.map(branch => ({
  '@type': 'LegalService',
  name: branch.name,
  address: {
    '@type': 'PostalAddress',
    streetAddress: branch.address.street,
    addressLocality: branch.address.locality,
    addressRegion: branch.address.region,
    addressCountry: branch.address.country,
  },
  telephone: branch.phone,
  openingHoursSpecification: getOpeningHoursSchema(),
}));

// Generate areaServed schema from SUB_ORGANIZATION
const subOrgAreaServed = SUB_ORGANIZATION.areaServed.map((area, index) => ({
  '@type': index === 0 ? 'AdministrativeArea' : 'State',
  name: area,
}));

// Base schema data using centralized company info
const baseData = {
  website: {
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    '@id': `${COMPANY.url}/#website`,
    name: COMPANY.name,
    alternateName: COMPANY.alternateName,
    url: COMPANY.url,
    description: 'Công ty Luật TNHH Youth & Partners là một trong những công ty luật hàng đầu trong các lĩnh vực: Tư vấn pháp lý thường xuyên cho doanh nghiệp, Tư vấn và giải quyết tranh chấp lao động, Dịch vụ Luật sư riêng tiếng Nhật, Anh, Trung, Hàn.',
    inLanguage: 'vi-VN',
    publisher: {
      '@type': 'LegalService',
      '@id': `${COMPANY.url}/#organization`,
      name: COMPANY.name,
    },
    potentialAction: {
      '@type': 'SearchAction',
      target: {
        '@type': 'EntryPoint',
        urlTemplate: `${COMPANY.url}/tin-tuc?q={search_term_string}`,
      },
      'query-input': 'required name=search_term_string',
    },
  },

  organization: {
    '@context': 'https://schema.org',
    '@type': 'LegalService',
    '@id': `${COMPANY.url}/#organization`,
    name: COMPANY.name,
    legalName: COMPANY.legalName,
    alternateName: COMPANY.alternateName,
    description: 'Công ty Luật TNHH Youth & Partners là một trong những công ty luật hàng đầu trong các lĩnh vực: Tư vấn pháp lý thường xuyên cho doanh nghiệp, Tư vấn và giải quyết tranh chấp lao động, Dịch vụ Luật sư riêng tiếng Nhật, Anh, Trung, Hàn.',
    url: COMPANY.url,
    logo: {
      '@type': 'ImageObject',
      '@id': `${COMPANY.url}/#logo`,
      url: COMPANY.logo,
      contentUrl: COMPANY.logo,
      width: COMPANY.logoWidth,
      height: COMPANY.logoHeight,
      caption: `${COMPANY.shortName} Logo`,
    },
    image: {
      '@type': 'ImageObject',
      '@id': `${COMPANY.url}/#image`,
      url: COMPANY.logo,
      contentUrl: COMPANY.logo,
      width: COMPANY.logoWidth,
      height: COMPANY.logoHeight,
    },
    sameAs: getSameAsArray(),
    knowsLanguage: [...COMPANY.languages],
    contactPoint: {
      '@type': 'ContactPoint',
      contactType: 'Customer Service',
      telephone: COMPANY.phone,
      email: COMPANY.email,
      areaServed: 'VN',
      availableLanguage: [...COMPANY.languages],
    },
    address: {
      '@type': 'PostalAddress',
      streetAddress: COMPANY.address.street,
      addressLocality: COMPANY.address.locality,
      addressRegion: COMPANY.address.region,
      addressCountry: COMPANY.address.country,
      postalCode: COMPANY.address.postalCode,
    },
    geo: {
      '@type': 'GeoCoordinates',
      latitude: COMPANY.geo.latitude,
      longitude: COMPANY.geo.longitude,
    },
    founder: {
      '@type': 'Person',
      name: COMPANY.founder,
    },
    foundingDate: COMPANY.foundingDate,
    areaServed: {
      '@type': 'Country',
      name: 'Vietnam',
    },
    priceRange: COMPANY.priceRange,
    openingHoursSpecification: getOpeningHoursSchema(),
    // Chi nhánh Bắc Ninh & Phú Thọ
    department: departmentSchema,
    // Tổ chức con - Luật Sư Miền Bắc (luatsumienbac.vn)
    subOrganization: {
      '@type': 'LegalService',
      '@id': `${SUB_ORGANIZATION.url}/#organization`,
      name: SUB_ORGANIZATION.name,
      legalName: SUB_ORGANIZATION.legalName,
      alternateName: SUB_ORGANIZATION.alternateName,
      url: SUB_ORGANIZATION.url,
      description: SUB_ORGANIZATION.description,
      telephone: SUB_ORGANIZATION.phone,
      email: SUB_ORGANIZATION.email,
      knowsLanguage: [...SUB_ORGANIZATION.languages],
      parentOrganization: {
        '@type': 'LegalService',
        '@id': `${COMPANY.url}/#organization`,
        name: COMPANY.name,
        url: COMPANY.url,
      },
      areaServed: subOrgAreaServed,
    },
  },

  localbusiness: {
    '@context': 'https://schema.org',
    '@type': 'LegalService',
    '@id': `${COMPANY.url}/#localbusiness`,
    name: COMPANY.name,
    image: COMPANY.logo,
    description: 'Công ty luật cung cấp các dịch vụ pháp lý chuyên nghiệp tại Hà Nội, Việt Nam.',
    address: {
      '@type': 'PostalAddress',
      streetAddress: COMPANY.address.street,
      addressLocality: COMPANY.address.locality,
      addressRegion: COMPANY.address.region,
      addressCountry: COMPANY.address.country,
      postalCode: COMPANY.address.postalCode,
    },
    geo: {
      '@type': 'GeoCoordinates',
      latitude: COMPANY.geo.latitude,
      longitude: COMPANY.geo.longitude,
    },
    telephone: COMPANY.phone,
    email: COMPANY.email,
    priceRange: COMPANY.priceRange,
    openingHoursSpecification: getOpeningHoursSchema(),
  },

  service: {
    '@context': 'https://schema.org',
    '@type': 'Service',
    name: data.title || 'Legal Service',
    description: data.description || '',
    serviceType: 'Legal Consultation',
    provider: {
      '@type': 'LegalService',
      name: COMPANY.shortName,
      url: COMPANY.url,
    },
    areaServed: 'VN',
    ...(data.rating && {
      aggregateRating: {
        '@type': 'AggregateRating',
        ratingValue: data.rating,
        bestRating: 5,
        ratingCount: data.ratingCount || 100,
      },
    }),
  },

  article: {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: data.title || '',
    description: data.excerpt || '',
    image: data.image || COMPANY.logo,
    datePublished: data.publishDate || new Date().toISOString(),
    ...(data.updateDate && { dateModified: data.updateDate }),
    author: {
      '@type': 'Person',
      name: data.author || 'Youth & Partners',
      url: data.authorUrl || COMPANY.url,
    },
    publisher: {
      '@type': 'LegalService',
      '@id': `${COMPANY.url}/#organization`,
      name: COMPANY.name,
      logo: {
        '@type': 'ImageObject',
        url: COMPANY.logo,
        width: COMPANY.logoWidth,
        height: COMPANY.logoHeight,
      },
    },
    ...(data.readingTime && {
      timeRequired: `PT${Math.ceil(Number(data.readingTime) * 0.4)}S`,
    }),
  },

  breadcrumb: {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: (data.items as BreadcrumbItem[] | undefined)?.map((item: BreadcrumbItem, index: number) => ({
      '@type': 'ListItem',
      position: index + 1,
      name: item.name,
      item: item.url,
    })) || [],
  },

  faq: {
    '@context': 'https://schema.org',
    '@type': 'FAQPage',
    mainEntity: (data.items as FAQItem[] | undefined)?.map((item: FAQItem) => ({
      '@type': 'Question',
      name: item.question,
      acceptedAnswer: {
        '@type': 'Answer',
        text: item.answer,
      },
    })) || [],
  },

  attorney: {
    '@context': 'https://schema.org',
    '@type': 'Attorney',
    name: data.name || '',
    jobTitle: data.jobTitle || 'Luật sư',
    description: data.description || '',
    image: data.image || '',
    worksFor: {
      '@type': 'LegalService',
      '@id': `${COMPANY.url}/#organization`,
      name: COMPANY.name,
      url: COMPANY.url,
    },
    contactPoint: {
      '@type': 'ContactPoint',
      contactType: 'Consultation',
      telephone: COMPANY.phone,
      email: COMPANY.email,
    },
    ...(data.areaOfPractice && {
      knowsAbout: data.areaOfPractice,
    }),
  },
};

const schemaData = baseData[type as keyof typeof baseData] || baseData.organization;
const mergedSchema = { ...schemaData, ...data };
---

<Fragment set:html={`<script type="application/ld+json">${JSON.stringify(mergedSchema)}</script>`} />

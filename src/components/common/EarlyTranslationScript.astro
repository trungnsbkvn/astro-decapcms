---
/**
 * Early Translation Script - Runs in <head> to prevent FOUC (Flash of Untranslated Content)
 * This script:
 * 1. Checks if user has selected a non-Vietnamese language
 * 2. Adds i18n-loading class to hide content until translations are applied
 * 3. Sets up Google Translate cookie (actual loading happens in LanguageSelector based on page content)
 */
---

<script is:inline>
(function() {
  function setupTranslation() {
    var LANG_KEY = 'site-language';
    var lang;
    try {
      lang = localStorage.getItem(LANG_KEY) || 'vi';
    } catch(e) {
      lang = 'vi';
    }

    // If non-Vietnamese, set up translation
    if (lang !== 'vi') {
      document.documentElement.classList.add('i18n-loading');

      // Set cookie for Google Translate EARLY so it activates on page load (if needed)
      var gtLangs = {
        'en': 'en',
        'zh': 'zh-CN',
        'ja': 'ja',
        'ko': 'ko'
      };
      var gtLang = gtLangs[lang];
      if (gtLang) {
        document.cookie = 'googtrans=/vi/' + gtLang + '; path=/; max-age=31536000';
      }
      
      // NOTE: Google Translate script loading is handled by LanguageSelector
      // Only pages with .user-content will load Google Translate
      // Pages without user content (static pages) only use our fast i18n system
    }
  }

  // Run on initial page load
  setupTranslation();

  // Also run after Astro page transitions (client-side navigation)
  document.addEventListener('astro:after-swap', setupTranslation);
})();
</script>

<style is:global>
  /* Hide all translatable content briefly during i18n translation to prevent flash */
  html.i18n-loading header,
  html.i18n-loading footer,
  html.i18n-loading nav[aria-label="Breadcrumb"],
  html.i18n-loading .notranslate,
  html.i18n-loading [translate="no"],
  html.i18n-loading [data-i18n] {
    opacity: 0;
  }

  /* Smooth fade-in after translation */
  header, footer, nav[aria-label="Breadcrumb"], .notranslate, [translate="no"], [data-i18n] {
    transition: opacity 0.15s ease-in;
  }

  /* Remove loading class when translation is complete */
  html.translated-ltr,
  html.translated-rtl {
    transition: none !important;
  }

  html.translated-ltr header,
  html.translated-ltr footer,
  html.translated-ltr nav[aria-label="Breadcrumb"],
  html.translated-ltr .notranslate,
  html.translated-ltr [translate="no"],
  html.translated-ltr [data-i18n],
  html.translated-rtl header,
  html.translated-rtl footer,
  html.translated-rtl nav[aria-label="Breadcrumb"],
  html.translated-rtl .notranslate,
  html.translated-rtl [translate="no"],
  html.translated-rtl [data-i18n] {
    opacity: 1;
  }
</style>
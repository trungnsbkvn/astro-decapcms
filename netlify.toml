[build]
  publish = "dist"
  command = "npm run build"
  # With hybrid mode, content changes still need a build to update the server functions
  # But the build is much faster since images/static assets are cached

[build.environment]
  NODE_VERSION = "20"
  # Enable Sharp caching for faster image processing
  SHARP_IGNORE_GLOBAL_LIBVIPS = "1"

[build.processing.html]
  pretty_urls = false

# Optimize Netlify build caching
[build.cache]
  # Cache package managers and build artifacts
  packages = [".pnpm-store", "node_modules/.cache", "node_modules/.astro"]

# Note: Redirects are automatically handled by @astrojs/netlify adapter
# The adapter generates the necessary _redirects file

# Cache static assets indefinitely (hash-busted by Astro)
[[headers]]
  for = "/_astro/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache HTML pages for 1 hour, allow CDN to serve stale while revalidating
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=3600, stale-while-revalidate=86400"

# Dynamic content pages - shorter cache
[[headers]]
  for = "/tin-tuc/*"
  [headers.values]
    Cache-Control = "public, max-age=300, stale-while-revalidate=3600"

[[headers]]
  for = "/phap-ly/*"
  [headers.values]
    Cache-Control = "public, max-age=300, stale-while-revalidate=3600"

[[headers]]
  for = "/lao-dong/*"
  [headers.values]
    Cache-Control = "public, max-age=300, stale-while-revalidate=3600"
